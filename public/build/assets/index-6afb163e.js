import{_ as ue}from"./AppSelect-888d5a9e.js";import{V as ne,_ as re}from"./VSnackbar-058c891d.js";import{_ as de}from"./DialogCloseBtn-10ae58d1.js";import{r as ie,R as me,u as pe,d as I,b as ce,A as J,e as fe,t as Ve,f as ve}from"./auth-149aec28.js";import{a as k}from"./axios-ae36d123.js";import{_ as _e}from"./AvatarPicker-92e99cee.js";import{V as L,d as T,a as le,b as E,c as Q}from"./VCard-eed1f9ea.js";import{V as ae,a as _}from"./VRow-44434673.js";import{j as v,a1 as W,G as X,a2 as te,o as A,b as B,w as l,n as e,p as a,A as K,E as R,L as b,C as m,x as O,l as q,c as ge,z as h,r as Ue}from"./main-61484bfe.js";import{V as H}from"./VDialog-b69e3ed7.js";import{V as Y}from"./VTextField-a174cf70.js";import{V as ee,a as we}from"./VSelect-763f483b.js";import{V as Ce,a as be}from"./VPagination-b555d563.js";import{V as N}from"./VSpacer-503329da.js";import"./forwardRefs-6ee72851.js";import"./transition-a33c81e5.js";import"./VBadge-70da9b1a.js";import"./VAvatar-08392dd6.js";import"./VImg-269a0fda.js";import"./VDivider-792f6d40.js";import"./VList-3e5c49b3.js";import"./VMenu-d32181aa.js";import"./VCheckboxBtn-7abc63b4.js";const ye={__name:"CreateDialog",props:{isDialogVisible:{type:Boolean,required:!1},user:{type:Object,required:!1},isUpdate:{type:Boolean,required:!1}},emits:["close-dialog"],setup(j,{emit:D}){const f=j,g=ie(),d=pe,U=v([]),w=W(f,"isDialogVisible"),s=W(f,"user"),i=v(""),y=X(()=>p.value.length>0),x=X(()=>s.value.role==me),p=v(""),F=()=>{D("close-dialog",!1)},P=()=>setTimeout(()=>{p.value=""},1500),z=()=>{const c=s.value;if(c.username.length==0){p.value="Username must be not empty.",P();return}if(!/^[a-zA-Z0-9_]+$/.test(c.username)){p.value="Username must contain alphanumeric and underscore characters only.",P();return}if(c.role=="Agent"&&(c.team_leader==0||c.team_leader=="")){p.value="You must select team leader.";return}if(c.status!="active"&&c.status!="inactive"){p.value="Status is wrong.",P();return}if(!f.isUpdate&&c.password.length==0){p.value="Password must be not empty.",P();return}if(!f.isUpdate&&c.password!=i.value){p.value="Password mismatch.",P();return}f.isUpdate?k.put("/users",c).then(t=>{D("close-dialog",!0),s.value=I}).catch(t=>{t.response||t.request||(p.value=t.message)}):k.post("/users",c).then(t=>{D("close-dialog",!0),s.value=I}).catch(t=>{t.response||t.request||(p.value=t.message)})},M=()=>{k.get("/users/leaders").then(c=>{const{leaders:t}=c.data;U.value=t.map($=>({value:$.id,title:$.name}))})};return te(()=>{M()}),(c,t)=>{const $=de,C=re,S=ue;return A(),B(H,{modelValue:a(w),"onUpdate:modelValue":t[12]||(t[12]=n=>R(w)?w.value=n:null),persistent:"","max-width":"720"},{default:l(()=>[e($,{onClick:F}),e(L,{title:"User Profile"},{default:l(()=>[e(T,null,{default:l(()=>[e(_e),e(ae,{class:"mt-4"},{default:l(()=>[e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(C,{modelValue:a(s).username,"onUpdate:modelValue":t[0]||(t[0]=n=>a(s).username=n),label:"User Name"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(C,{modelValue:a(s).name,"onUpdate:modelValue":t[1]||(t[1]=n=>a(s).name=n),label:"Name"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(C,{modelValue:a(s).email,"onUpdate:modelValue":t[2]||(t[2]=n=>a(s).email=n),label:"Email","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(S,{modelValue:a(s).role,"onUpdate:modelValue":t[3]||(t[3]=n=>a(s).role=n),items:a(g),label:"Role"},null,8,["modelValue","items"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[a(x)?(A(),B(S,{key:0,modelValue:a(s).team_leader,"onUpdate:modelValue":t[4]||(t[4]=n=>a(s).team_leader=n),items:a(U),label:"Team Leader"},null,8,["modelValue","items"])):K("",!0)]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(S,{modelValue:a(s).status,"onUpdate:modelValue":t[5]||(t[5]=n=>a(s).status=n),items:a(d),label:"Status"},null,8,["modelValue","items"])]),_:1}),f.isUpdate?K("",!0):(A(),B(_,{key:0,cols:"12",sm:"6"},{default:l(()=>[e(C,{modelValue:a(s).password,"onUpdate:modelValue":t[6]||(t[6]=n=>a(s).password=n),label:"Password",type:"password"},null,8,["modelValue"])]),_:1})),f.isUpdate?K("",!0):(A(),B(_,{key:1,cols:"12",sm:"6"},{default:l(()=>[e(C,{modelValue:a(i),"onUpdate:modelValue":t[7]||(t[7]=n=>R(i)?i.value=n:null),label:"Password Confirmation",type:"password"},null,8,["modelValue"])]),_:1})),e(_,{cols:"12",sm:"6"},{default:l(()=>[e(C,{modelValue:a(s).caller_id,"onUpdate:modelValue":t[8]||(t[8]=n=>a(s).caller_id=n),label:"Caller ID",type:"number"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6"},{default:l(()=>[e(C,{modelValue:a(s).contact_number,"onUpdate:modelValue":t[9]||(t[9]=n=>a(s).contact_number=n),label:"Contact Number",type:"text"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{class:"d-flex justify-end flex-wrap gap-3"},{default:l(()=>[e(b,{variant:"tonal",color:"secondary",onClick:t[10]||(t[10]=n=>w.value=!1)},{default:l(()=>[m(" Close ")]),_:1}),e(b,{onClick:z},{default:l(()=>[m(" Save ")]),_:1})]),_:1})]),_:1}),e(ne,{modelValue:a(y),"onUpdate:modelValue":t[11]||(t[11]=n=>R(y)?y.value=n:null),timeout:1e3,location:"top end",color:"error"},{default:l(()=>[m(O(a(p)),1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},xe={class:"d-flex align-center mx-4"},ke={__name:"FilterUser",emits:["apply-filter"],setup(j,{emit:D}){const f=ce(),g=fe,d=v({id:"",name:"",role:J,status:J}),U=()=>{D("apply-filter",d.value)};return(w,s)=>(A(),B(L,null,{default:l(()=>[e(le,null,{default:l(()=>[e(E,null,{default:l(()=>[m("Filter ")]),_:1})]),_:1}),e(T,null,{default:l(()=>[q("div",xe,[e(Y,{modelValue:a(d).id,"onUpdate:modelValue":s[0]||(s[0]=i=>a(d).id=i),label:"Id"},null,8,["modelValue"]),e(Y,{class:"ml-4",modelValue:a(d).name,"onUpdate:modelValue":s[1]||(s[1]=i=>a(d).name=i),label:"Name"},null,8,["modelValue"]),e(ee,{class:"ml-4",modelValue:a(d).role,"onUpdate:modelValue":s[2]||(s[2]=i=>a(d).role=i),items:a(f),variant:"outlined",label:"Role"},null,8,["modelValue","items"]),e(ee,{class:"ml-4",modelValue:a(d).status,"onUpdate:modelValue":s[3]||(s[3]=i=>a(d).status=i),items:a(g),variant:"outlined",label:"Status"},null,8,["modelValue","items"]),e(b,{class:"ml-4",onClick:U},{default:l(()=>[m(" Apply ")]),_:1})])]),_:1})]),_:1}))}},De={class:"d-flex gap-1"},Pe=q("br",null,null,-1),$e=q("div",null,null,-1),Xe={__name:"index",setup(j){const D=ve.user,f=v([]),g=v([]),d=v(Ve),U=v(I),w=v(!1),s=v(!1),i=v(!1),y=v(-1),x=v(!1),p=v(-1),F=u=>u==="active"?{color:"success",text:u}:{color:"secondary",text:u},P=()=>{s.value=!0,w.value=!1,U.value=I},z=u=>{s.value=!1,U.value=I,u&&Z()},M=u=>{k.get(`/users/${u}`).then(o=>{const{user:V}=o.data;U.value=V,s.value=!0,w.value=!0})},c=u=>{i.value=!0,y.value=u},t=()=>{i.value=!1,y.value=-1},$=()=>{k.delete(`/users/${y.value}`).then(u=>{const{users:o}=u.data;f.value=o,g.value=o,i.value=!1,y.value=-1})},C=u=>{x.value=!0,p.value=u},S=()=>{x.value=!1,p.value=-1},n=()=>{k.put(`/users/${p.value}/reset-password`).then(u=>{x.value=!1,p.value=-1})},Z=()=>{k.get("/users").then(u=>{const{users:o}=u.data;f.value=o,g.value=o})},se=u=>{k.put(`/users/activate/${u}`).then(o=>{const{users:V}=o.data;f.value=V,g.value=V})},oe=u=>{let o=f.value;u.id!=""&&(o=o.filter(V=>V.id==u.id)),u.name!=""&&(o=o.filter(V=>V.username.includes(u.name))),u.role!="All"&&(o=o.filter(V=>V.role==u.role)),u.status!="All"&&(o=o.filter(V=>V.status==u.status)),g.value=[...o]};return te(()=>{Z()}),(u,o)=>{const V=Ue("IconBtn");return A(),ge("div",null,[e(ke,{onApplyFilter:oe}),e(L,{class:"mt-4"},{default:l(()=>[e(le,null,{append:l(()=>[e(b,{onClick:P,size:"small",icon:"tabler-plus"})]),default:l(()=>[e(E,null,{default:l(()=>[m("User List")]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(a(Ce),{headers:a(D),items:a(g),"items-per-page":a(d).itemsPerPage,page:a(d).page,"onUpdate:options":o[2]||(o[2]=r=>d.value=r)},{"item.status":l(({item:r})=>[e(we,{color:F(r.raw.status).color,onClick:G=>se(r.raw.id),size:"small"},{default:l(()=>[m(O(F(r.raw.status).text),1)]),_:2},1032,["color","onClick"])]),"item.team_leader":l(({item:r})=>[m(O(r.raw.leader?r.raw.leader.name:""),1)]),"item.created_at":l(({item:r})=>[m(O(new Date(r.raw.created_at).toISOString().slice(0,19).replace("T"," ")),1)]),"item.actions":l(({item:r})=>[q("div",De,[e(V,{onClick:G=>M(r.raw.id)},{default:l(()=>[e(h,{icon:"mdi-pencil-outline"})]),_:2},1032,["onClick"]),e(V,{onClick:G=>c(r.raw.id)},{default:l(()=>[e(h,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"]),e(b,{rounded:"",onClick:G=>C(r.raw.id)},{default:l(()=>[m(" Reset Password ")]),_:2},1032,["onClick"])])]),bottom:l(()=>[e(T,{class:"mt-8"},{default:l(()=>[e(ae,null,{default:l(()=>[e(_,{lg:"2",cols:"3"},{default:l(()=>[e(Y,{modelValue:a(d).itemsPerPage,"onUpdate:modelValue":o[0]||(o[0]=r=>a(d).itemsPerPage=r),label:"Rows per page:",type:"number",min:"-1",max:"15","hide-details":""},null,8,["modelValue"])]),_:1}),e(_,{lg:"10",cols:"9",class:"d-flex justify-end"},{default:l(()=>[e(be,{modelValue:a(d).page,"onUpdate:modelValue":o[1]||(o[1]=r=>a(d).page=r),"total-visible":"5",length:Math.ceil(a(f).length/a(d).itemsPerPage)},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1},8,["headers","items","items-per-page","page"]),e(ye,{isDialogVisible:a(s),user:a(U),isUpdate:a(w),onCloseDialog:z},null,8,["isDialogVisible","user","isUpdate"]),e(H,{modelValue:a(i),"onUpdate:modelValue":o[3]||(o[3]=r=>R(i)?i.value=r:null),"max-width":"500px"},{default:l(()=>[e(L,null,{default:l(()=>[e(E,{class:"px-8 py-8"},{default:l(()=>[m(" Are you sure you want to delete this user? ")]),_:1}),e(Q,null,{default:l(()=>[e(N),e(b,{color:"error",variant:"outlined",onClick:t},{default:l(()=>[m(" Cancel ")]),_:1}),e(b,{color:"success",variant:"elevated",onClick:$},{default:l(()=>[m(" OK ")]),_:1}),e(N)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:a(x),"onUpdate:modelValue":o[4]||(o[4]=r=>R(x)?x.value=r:null),"max-width":"600px"},{default:l(()=>[e(L,null,{default:l(()=>[e(E,{class:"text-center px-8 py-8"},{default:l(()=>[m(" Are you sure you want to reset password"),Pe,m(" of this user (Password: 123456)? ")]),_:1}),$e,e(Q,null,{default:l(()=>[e(N),e(b,{color:"error",variant:"outlined",onClick:S},{default:l(()=>[m(" Cancel ")]),_:1}),e(b,{color:"success",variant:"elevated",onClick:n},{default:l(()=>[m(" OK ")]),_:1}),e(N)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}};export{Xe as default};
